---
title: "STAT463 Project: Sleep Health and Lifestyle"
author: "Lisa Lu 31088272"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(stringr)
```


```{r}
dataset <- read.table("Sleep_health_and_lifestyle_dataset.csv", 
                      header = TRUE, sep = ',', na.strings = "na")

# Split Blood Pressure column into systolic and diastolic pressure
dataset[c('Systolic.Pressure', 'Diastolic.Pressure')] <- as.numeric(str_split_fixed(dataset$Blood.Pressure, '/', 2))

sleep <- dataset[, -10]

summary(dataset)
# Frequency chart
dataset %>% 
  ggplot(aes(x = Occupation)) +
  geom_bar() +
  labs(y = "Frequency", x = "Occupation") 
```


# Explore the factors affecting quality of sleep
```{r}
# Use linear regression model
lr <- lm(Quality.of.Sleep ~ Stress.Level + Heart.Rate + Systolic.Pressure + Diastolic.Pressure, data = sleep)
summary(lr)
plot(lr)

lr1 <- lm(Quality.of.Sleep ~ Age + Stress.Level + Occupation, data = sleep)
summary(lr1)

lr2 <- lm(Quality.of.Sleep ~ Age + Gender + Occupation + Sleep.Duration + Physical.Activity.Level + Stress.Level + Heart.Rate + Daily.Steps + Systolic.Pressure + Diastolic.Pressure, data = sleep)
summary(lr2)
# Use PCA analysis
# Standardise the Quality of sleep and stress level
Quality.of.Sleep <- data.frame(scale(sleep$Quality.of.Sleep))
Stress.Level <- data.frame(scale(sleep$Stress.Level))
Physical.Level <-data.frame(scale(sleep$Physical.Activity.Level))

pca_dataset <- select(sleep, Age, Physical.Activity.Level, Stress.Level, Sleep.Duration, Heart.Rate, Daily.Steps, Systolic.Pressure, Diastolic.Pressure)
pca <- prcomp(scale(pca_dataset))
screeplot(pca)
summary(pca)
pca$rotation
biplot(pca)
```

```{r}
step.model <- step(lr2, direction = "backward")
summary(step.model)

```


# Explore the causes of sleep disorder
```{r}
# Multinomial Logistic Regression: predict the probablities of categorically dependent variable
library(nnet)
mlr <- multinom(Sleep.Disorder ~ Gender + Occupation + Stress.Level + Physical.Activity.Level, data = sleep)
summary(mlr)
exp(summary(mlr)$coefficients)
step(mlr, direction = 'backward')

lm1 <- 
```

# Generalised Linear Mixed Model
```{r}
library(lme4)
m1 <- lmer(Quality.of.Sleep ~ Sleep.Duration + Stress.Level + (1|Occupation), data = sleep)
summary(m1)
m2 <- lmer(Quality.of.Sleep ~ Sleep.Duration + (1|Occupation), data=sleep)
summary(m2)
```

