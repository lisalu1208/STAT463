---
title: 'Assignment 3 STAT 315-463:  Multivariable Statistical Methods and Applications'
header-includes:
   - \usepackage{bm}
   - \usepackage{amsmath}
output: 
  pdf_document:
    number_sections: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
\vspace{-8 mm}
**Due date: Friday 28 April 2023**  
\vspace{-7 mm}

- Your assignment needs to show the R code you used, and your well discussed answers to  the questions. 
- Submit your assignments on Learn.
\vspace{- 2 mm}

## Background

In \texttt{Contraception315.csv}, you are provided with a dataset, modified from a study originally undertaken to ascertain associations concerning contraceptive use among Bangladeshi women. The data available for this assignment consists of data on 453 women in 5 districts. The predictor variables are

- *use*, an indicator for contraceptive use (coded N for no and Y for yes).

- Two geographical location covariates, *district* (5 levels), and *urban* (2 levels), which should be treated as factor variables.

- A continuous covariate for standardised age *age*

The response variable is the number of living children *livch* (0, 1, 2, 3, 4, 5, 6, 7).


## Questions

1. Fit a Poisson Regression including all possible predictor variables. (1 mark)
```{r}
# Read in data
dataset <- read.csv("Contraception315.csv")
# Convert District variable into factor
dataset$district <- as.factor(dataset$district)
str(dataset)
# Fit a Poisson Regression
poisson_full <- glm(formula = livch ~ district + use + urban + age, 
                     data = dataset, family = poisson())
summary(poisson_full)
```
   

2. Apply either forward or backward selection to determine the most appropriate model for this data. For the chosen model, write down the model equation. (2 marks)
```{r}
library(MASS)
# Apply the forward selection
poisson_null <- glm(livch ~ 1, data = dataset, family = poisson())
poisson_model1 <- step(poisson_null, direction = "forward", 
                      scope = list(lower = poisson_null, upper = poisson_full))
summary(poisson_model1)
```
Here the forward model selection was used. The most significant variable here is the age of the women, followed by the contraceptive use. The other two less significant variables are living in district 14 and living in the urban. 
$$
log(livch) = 0.705 + 0.066*age + 0.347*useY - 0.264*district14 - 0.178*urbanY 
$$


3. For the model chosen in 2, provide an interpretation of the regression coefficients, on both the link scale and the response scale. Include 95 \% confidence intervals (4 marks)

Here, three variables are discussed here, namely, **age**, **use**, and **urban**. Because there is not much information on the district, it is not much considered here.

As we can see from the coeffients of the variables in model chosen in Q2, 
```{r}
# Age
exp(poisson_model1$coefficients['age'])
# useY
exp(poisson_model1$coefficients['useY'])
# urbanY
exp(-poisson_model1$coefficients['urbanY'])
```


The coefficient of variable **Use** is 0.28, with the standard deviation of 0.06350. \\
Use: $e^{0.31} = 1.36$ \\
Urban: $e^{-0.24} = 0.79$ \\
Age: $e^{0.06} = 1.06$

4. Describe what the implication of unaccounted overdispersion would be for any inference made. Comment on whether you believe overdispersion is present in this dataset. Describe how you would change your analysis to deal with overdispersion.  (4 marks)
```{r}
summary(poisson_model1)
```
Overdispersion can be detected by dividing the residual deviance by the degrees of freedoms. Here we can see that there is overdispersion present in this dataset. One potential approach to deal with overdispersion is to use negative binomial model, which explicitly models the overdispersion that happens in the dataset. 

5. You are later told that the researchers in comparisons between women without children and women with children. Create a new variable \texttt{child} such that a \texttt{0} indicates a women with no living children, and \texttt{1} indicates a women with at least one living child. (1 mark)
```{r,warning=FALSE, message=FALSE}
library(dplyr)
dataset1 <- dataset %>%
  mutate(child = case_when(livch == 0 ~ 0,
                           livch > 0 ~ 1))
head(dataset1)
```


6. Fit a Logistic Regression including all possible predictor variables and \texttt{child} as the response. (1 mark)
```{r}
lr_full <- glm(child ~ district + use + age + urban, data = dataset1, family = binomial())
summary(lr_full)
```

7. Apply either forward or backward selection to determine the most appropriate model for this data. For the chosen model, write down the model equation. Were the same predictor variables chosen as the Poisson regression (3 marks)
```{r}
lr_null<- glm(child ~ 1, family = binomial(), data = dataset1)
# Apply the backward selection
lr1 <- stepAIC(lr_full, direction = 'backward', 
                scope = list(upper = lr_full,lower = lr_null))
summary(lr1)
```
Here the backward selection was used. The chosen variables were quite similar to the previous model. The equation in this case is shown below:
$$
Logit[child] = 1.978 + 0.262*age + 1.024*useY-0.691*urbanY
$$

8. If $Y$ is Poisson distributed with parameter $\lambda$, then $\Pr(Y > 0) = 1 -e^{-\lambda}$. Use this to construct estimates of the probability of having at least one living child for each women in the study from the Poisson regression model chosen in part 2. Compare this to the estimate of the probability of having at least one living child for each women in the study using the Logistic regression model chosen in part 7. (Note: Due to the number of women in the study, do not provide a table of all the estimated probabilities. Instead focus on graphical visualizations to determine any similarities and differences.) (4 marks)
```{r}
pred_glm <- predict(poisson_model1, type = "response")
prob_glm <- (1 - exp(-pred_glm)) * 100
summary(prob_glm)
pred_lr <- predict(lr1, type="response")
prob_lr <- log(pred_lr, 1-pred_lr)

```
As we can see from the summary, the 


