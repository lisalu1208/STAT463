---
title: 'Assignment 5 STAT 315-463:  Multivariable Statistical Methods and Applications'
author: 'Lisa Lu 31088272'
header-includes:
   - \usepackage{bm}
   - \usepackage{amsmath}
output: 
  pdf_document:
    number_sections: no
---


```{r}
# Read in data file
initobs <- read.table("initobs.csv", header = TRUE, sep = ',', na.strings = "na")
```

**a) Explain why observer should be included in a model as a random effect.**

```{r}
pardef <- par()
par(mfrow = c(1,2))
plot(as.factor(initobs$Observer), xlab="Observer", ylab="Count")
plot(as.factor(initobs$Observer),initobs$Bc/initobs$Steps * 100, 
     xlab="Observer", ylab="% of ground cover of the weed")
```

From the left plot above, we can see that the number of occurrence of each observer varies greatly. The right plot also suggested that the distribution of the percentage of ground covered by the weed differs from each observer. Therefore, the observers are the source of random variation, which should be taken into consideration when choosing the model as it brings potential effects on the relationship between the control of the weed and the different treatments. 

**b) What distribution would be appropriate for these data and why?**

The dependent variable here, namely, the occurrence of the weed (buttercup) are not continuous. In a more visualised way, from the histogram of the frequency of the buttercup shown in the left plot, we can see that it does not follow the normal distribution. Therefore it is not suitable to use normal linear regression models. Here, we would like to investigate the control of the weed by using different treatments. Each test has two potential outcomes: Has Bc or No Bc, and each test is exclusive or independent of one another. As shown in the right plot below, the data follows a discrete distribution. Therefore, binomial distribution should be considered as an appropriate way to fit the model. 

```{r}
pardef <- par()
par(mfrow = c(1,2))
hist(initobs$Bc)
plot(as.factor(initobs$Trt), initobs$Bc/initobs$Steps * 100, 
     xlab="Treatment",ylab="% of ground cover of the weed")
```


**c) Fit an appropriate random effects model to these data**

```{r, warning=FALSE, message=FALSE}
library(lme4)
initobs$Plot <- as.factor(initobs$Plot)
model.0 <- glmer(cbind(Bc, NotBc) ~ Trt + (1|Observer), 
            family = binomial, data = initobs)
model.1 <- glmer(cbind(Bc, NotBc) ~ Trt + (0 + Trt|Observer), 
            family = binomial, data = initobs)
model.2<- glmer(cbind(Bc, NotBc) ~ Trt + (1|Observer) + (1|Farm) + (1|Plot), 
            family = binomial, data = initobs)
model.3 <- glmer(cbind(Bc, NotBc) ~ Trt + Farm + (1|Observer), 
            family = binomial, data = initobs)
model.4 <- glmer(cbind(Bc, NotBc) ~ Trt + Farm + Plot + (1|Observer), 
            family = binomial, data = initobs)
anova(model.0, model.1, model.2,model.3, model.4)
summary(model.4)
```

* a. Discuss the results of the analysis, include comments about the following:
  + i). Scaled residuals
  + ii). Random effects
  + iii). Fixed effects
* b. What would your overall conclusion be?

**d) Draw graphs of the residuals and the random effects and comment on these.**
```{r}
# Create plots of the residuals
par(mfrow=c(1,3))
qqnorm(resid(m1, main = "Residual Plot"))
abline(0,1)
hist(resid(m1), main = "Histogram of Residuals")
plot(fitted(m1), resid(m1), xlab = "Fitted", ylab="Residuals")
abline(0,0)
```
# The plots above show the distribution of the residuals. 


```{r}
# Create plots of random effects
re1 <- ranef(m1)$Observer
# re2 <- ranef(m1)$Farm
# re <- data.frame(Observer = re1, Farm = re2)
# boxplot(re, col=c("lightblue", "lightpink"), main="Random Effects Boxplot",
       # names=c("Observer","Farm"),ylab="Random Effects")
boxplot(re1, main="Random Effects Boxplot",
       xlab="Observer",ylab="Random Effects")
```

