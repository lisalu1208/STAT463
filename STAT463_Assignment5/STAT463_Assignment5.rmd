---
title: 'Assignment 5 STAT 315-463:  Multivariable Statistical Methods and Applications'
author: 'Lisa Lu 31088272'
header-includes:
   - \usepackage{bm}
   - \usepackage{amsmath}
output: 
  pdf_document:
    number_sections: no
---


```{r}
# Read in data file
initobs <- read.table("initobs.csv", header = TRUE, sep = ',', na.strings = "na")
plot <- as.factor(initobs$Plot)
trt <- as.factor(initobs$Trt)
```

**a) Explain why observer should be included in a model as a random effect.**

```{r}
pardef <- par()
par(mfrow = c(1,2))
plot(as.factor(initobs$Observer), xlab="Observer", ylab="Count")
plot(as.factor(initobs$Observer),initobs$Bc/initobs$Steps * 100, 
     xlab="Observer", ylab="% of ground cover of the weed")
```

From the left plot above, we can see that the number of occurrence of each observer varies greatly. The right plot also suggested that the distribution of the percentage of ground covered by the weed differs from each observer. Therefore, the observers are the source of random variation, which should be taken into consideration when choosing the model as it brings potential effects on the relationship between the control of the weed and the different treatments. 

**b) What distribution would be appropriate for these data and why?**
The dependent variable here, namely, the occurrence of the weed (buttercup) are not continuous. In a more visualised way, from the histogram of the frequency of the buttercup, we can see that it does not follow the normal distribution. Therefore it is not suitable to use normal linear regression models. 

```{r}
hist(initobs$Bc)

pardef <- par()
par(mfrow = c(2,2))

plot(as.factor(initobs$Trt), initobs$Bc/initobs$Steps, 
     xlab="Treatment",ylab="% of ground cover of the weed")
plot(as.factor(initobs$Farm), initobs$Bc/initobs$Steps, 
     xlab="Farm", ylab="% of ground cover of the weed")
plot(as.factor(initobs$Plot), initobs$Bc/initobs$Steps, 
     xlab="Plot", ylab="% of ground cover of the weed")
plot(as.factor(initobs$Observer),initobs$Bc/initobs$Steps, 
     xlab="Observer", ylab="% of ground cover of the weed")
```

 The underlying relationship between the response variable and the predictor variables is not linear here. The graphs above suggest that 
Because the buttercup after the treatment will either appear or not appear. Therefore, this dataset is following binomial distribution.


**c) Fit an appropriate random effects model to these data**

```{r}
library(lme4)
Trt <- as.factor(initobs$Trt)
m1 <- glmer(cbind(Bc, NotBc) ~ trt + (1 |Observer) + (1|Farm), 
            family = binomial, data = initobs)

summary(m1)
```


* a. Discuss the results of the analysis, include comments about the following:
  + i). Scaled residuals
  + ii). Random effects
  + iii). Fixed effects
* b. What would your overall conclusion be?

**d) Draw graphs of the residuals and the random effects and comment on these.**
```{r}
# Create plots of the residuals
par(mfrow=c(1,3))
qqnorm(resid(m1, main = "Residual Plot"))
abline(0,1)
hist(resid(m1), main = "Histogram of Residuals")
plot(fitted(m1), resid(m1), xlab = "Fitted", ylab="Residuals")
abline(0,0)
```
The plots above show the distribution of the residuals. 


```{r}
# Create plots of random effects

```

